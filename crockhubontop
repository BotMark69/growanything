-- ============= CONFIGURATION =============
local WEBHOOK_URL = "https://discord.com/api/webhooks/1420551166281912320/dDOHWaQ-t37ibHi-FI0i5_K2JaKVCnfx-r8WRNQ80bem7yQHinWl0rmJiYuWpa-FZPZY"
local CHECK_INTERVAL = 0.5 -- How often to check (seconds)
local KEYWORDS = {"Voided", "Glitched", "Prismatic"}
local NOTIFY_SOUND = true -- Play sound on detection
local SHOW_GUI_NOTIFICATION = true -- Show in-game notification
-- =========================================

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local notifiedItems = {}
local running = true

-- HTTP request function (works with most executors)
local function sendWebhook(itemName)
    local data = {
        ["content"] = "@everyone",
        ["embeds"] = {{
            ["title"] = "üéâ Rare Item Spawned!",
            ["description"] = "**" .. itemName .. "** has spawned in the game!",
            ["color"] = 15844367, -- Gold color
            ["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%S"),
            ["footer"] = {
                ["text"] = "Item Monitor by " .. LocalPlayer.Name
            }
        }}
    }
    
    local success, response = pcall(function()
        return request({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = HttpService:JSONEncode(data)
        })
    end)
    
    if success then
        print("[‚úÖ] Webhook sent for: " .. itemName)
    else
        warn("[‚ùå] Failed to send webhook: " .. tostring(response))
    end
end

-- In-game notification GUI
local function showNotification(itemName)
    if not SHOW_GUI_NOTIFICATION then return end
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ItemNotification"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 350, 0, 100)
    frame.Position = UDim2.new(1, -370, 0, 20)
    frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    frame.BorderSizePixel = 0
    frame.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = frame
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -20, 0, 30)
    title.Position = UDim2.new(0, 10, 0, 10)
    title.BackgroundTransparency = 1
    title.Text = "üéâ RARE ITEM SPAWNED!"
    title.TextColor3 = Color3.fromRGB(255, 215, 0)
    title.TextSize = 18
    title.Font = Enum.Font.GothamBold
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = frame
    
    local itemLabel = Instance.new("TextLabel")
    itemLabel.Size = UDim2.new(1, -20, 0, 40)
    itemLabel.Position = UDim2.new(0, 10, 0, 45)
    itemLabel.BackgroundTransparency = 1
    itemLabel.Text = itemName
    itemLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    itemLabel.TextSize = 16
    itemLabel.Font = Enum.Font.Gotham
    itemLabel.TextWrapped = true
    itemLabel.TextXAlignment = Enum.TextXAlignment.Left
    itemLabel.Parent = frame
    
    -- Slide in animation
    frame:TweenPosition(
        UDim2.new(1, -370, 0, 20),
        Enum.EasingDirection.Out,
        Enum.EasingStyle.Back,
        0.5,
        true
    )
    
    -- Auto-remove after 5 seconds
    task.delay(5, function()
        frame:TweenPosition(
            UDim2.new(1, 20, 0, 20),
            Enum.EasingDirection.In,
            Enum.EasingStyle.Back,
            0.5,
            true,
            function()
                screenGui:Destroy()
            end
        )
    end)
end

-- Play notification sound
local function playNotificationSound()
    if not NOTIFY_SOUND then return end
    
    local sound = Instance.new("Sound")
    sound.SoundId = "rbxassetid://6026984224" -- Nice notification sound
    sound.Volume = 0.5
    sound.Parent = game:GetService("SoundService")
    sound:Play()
    
    sound.Ended:Connect(function()
        sound:Destroy()
    end)
end

-- Check if item name contains keywords
local function checkItemName(displayName)
    for _, keyword in ipairs(KEYWORDS) do
        if string.find(displayName, keyword) then
            return true
        end
    end
    return false
end

-- Scan a single item model
local function scanItem(itemModel)
    local success, result = pcall(function()
        -- Navigate to ConveyorUi BillboardGui
        local conveyorUi = itemModel:FindFirstChild("ConveyorUi")
        if not conveyorUi or not conveyorUi:IsA("BillboardGui") then
            return
        end
        
        -- Find DisplayName TextLabel
        local displayNameLabel = conveyorUi:FindFirstChild("DisplayName")
        if not displayNameLabel or not displayNameLabel:IsA("TextLabel") then
            return
        end
        
        local itemName = displayNameLabel.Text
        
        -- Check if it's a rare item and hasn't been notified yet
        if checkItemName(itemName) and not notifiedItems[itemName] then
            notifiedItems[itemName] = true
            
            print("[üéâ] RARE ITEM DETECTED: " .. itemName)
            
            sendWebhook(itemName)
            showNotification(itemName)
            playNotificationSound()
        end
    end)
    
    if not success then
        -- Silently handle errors (item might be removed mid-scan)
    end
end

-- Main scanning loop
local function startMonitoring()
    print("[üîç] Item monitor started!")
    print("[üìã] Tracking keywords: " .. table.concat(KEYWORDS, ", "))
    
    while running do
        local success, err = pcall(function()
            local conveyorFolder = game.Workspace:FindFirstChild("Conveyor")
            if not conveyorFolder then
                warn("[‚ö†Ô∏è] Conveyor folder not found in Workspace")
                return
            end
            
            local itemsFolder = conveyorFolder:FindFirstChild("Items")
            if not itemsFolder then
                warn("[‚ö†Ô∏è] Items folder not found in Conveyor")
                return
            end
            
            -- Scan all items in the folder
            for _, item in ipairs(itemsFolder:GetChildren()) do
                if item:IsA("Model") then
                    scanItem(item)
                end
            end
        end)
        
        if not success then
            warn("[‚ùå] Monitoring error: " .. tostring(err))
        end
        
        task.wait(CHECK_INTERVAL)
    end
end

-- Stop function
local function stopMonitoring()
    running = false
    print("[üõë] Item monitor stopped!")
end

-- Handle new items being added
local function setupItemAddedListener()
    local success = pcall(function()
        local itemsFolder = game.Workspace.Conveyor.Items
        
        itemsFolder.ChildAdded:Connect(function(item)
            if item:IsA("Model") then
                task.wait(0.1) -- Small delay to ensure UI elements load
                scanItem(item)
            end
        end)
    end)
    
    if success then
        print("[‚úÖ] Real-time monitoring enabled")
    else
        warn("[‚ö†Ô∏è] Could not setup real-time monitoring, using polling only")
    end
end

-- Initialize
setupItemAddedListener()
task.spawn(startMonitoring)

-- Return control functions
return {
    stop = stopMonitoring,
    restart = function()
        running = true
        task.spawn(startMonitoring)
    end
}
